<!DOCTYPE html>
<html>
<head>
    <title>The Pineapple Express Tracker</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

    <style>
        body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #e0f7fa; }

        #map { height: 100vh; width: 100%; }

        /* Dashboard */
        #bruce-dashboard {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 350px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            border: 2px solid #0288d1;
        }

        h1 { margin: 0 0 10px; color: #01579b; font-size: 24px; text-align: center; }

        .status-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .label { font-weight: bold; color: #555; }
        .value { font-weight: bold; }

        .status-active { color: #2e7d32; }
        .status-docked { color: #c62828; }

        .bruce-meter {
            background: #263238;
            color: #4fc3f7;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-top: 15px;
            font-family: monospace;
        }

        .bruce-count { font-size: 32px; display: block; }

        /* Suspicious Activity Box */
        #suspicious-box {
            position: absolute;
            bottom: 25px;
            left: 25px;
            max-width: 360px;
            background: rgba(255, 235, 59, 0.95);
            border: 3px dashed #f57f17;
            border-radius: 14px;
            padding: 14px 16px;
            display: none;
            z-index: 2000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            animation: wiggle 1.2s infinite;
        }

        .title-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .alert-icon {
            font-size: 26px;
            animation: flash 1s infinite;
        }

        .alert-title {
            font-weight: 800;
            color: #5d4037;
            letter-spacing: 0.3px;
        }

        .alert-text {
            margin-top: 8px;
            font-size: 14px;
            font-weight: bold;
            color: #5d4037;
            text-align: center;
            line-height: 1.3;
        }

        @keyframes flash {
            0% { opacity: 1; }
            50% { opacity: 0.25; }
            100% { opacity: 1; }
        }

        @keyframes wiggle {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(0.6deg); }
            75% { transform: rotate(-0.6deg); }
            100% { transform: rotate(0deg); }
        }
    </style>
</head>

<body>

<div id="bruce-dashboard">
    <h1>üõ≥Ô∏è The Pineapple Express</h1>

    <div class="status-row">
        <span class="label">Current Status:</span>
        <span class="value" id="status-text">Loading...</span>
    </div>

    <div class="status-row">
        <span class="label">Trip Day:</span>
        <span class="value" id="trip-day">--</span>
    </div>

    <div class="status-row">
        <span class="label">Next Stop:</span>
        <span class="value" id="next-stop">--</span>
    </div>

    <div class="bruce-meter">
        <span class="bruce-count" id="bruce-counter">0000</span>
        <span>Total Pineapples üçç</span>
    </div>
</div>

<!-- Suspicious Activity Box -->
<div id="suspicious-box">
    <div class="title-row">
        <div class="alert-icon">‚ö†Ô∏è</div>
        <div class="alert-title">SUSPICIOUS ACTIVITY</div>
    </div>
    <div class="alert-text" id="suspicious-text"></div>
</div>

<div id="map"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCUefb8ZLoq9mlu4NwTgt0SkZCHxH3QnOI&callback=initMap&v=weekly" async></script>

<script>
let map;
let shipMarker;

function getDate(day, time) {
    return new Date(`2026-${day}T${time}:00+13:00`).getTime();
}

const schedule = [
    { name: "Auckland", lat: -36.8485, lng: 174.7633, arrival: null, departure: getDate("01-20","18:00") },
    { name: "Bay of Islands", lat: -35.2621, lng: 174.1220, arrival: getDate("01-21","07:00"), departure: getDate("01-21","19:00") },
    { name: "Napier", lat: -39.4928, lng: 176.9120, arrival: getDate("01-23","08:00"), departure: getDate("01-23","17:00") },
    { name: "Wellington", lat: -41.2865, lng: 174.7762, arrival: getDate("01-24","08:00"), departure: getDate("01-24","19:00") },
    { name: "Nelson", lat: -41.2706, lng: 173.2840, arrival: getDate("01-25","08:00"), departure: getDate("01-25","20:00") },
    { name: "Picton", lat: -41.2930, lng: 174.0079, arrival: getDate("01-26","08:00"), departure: getDate("01-26","16:00") },
    { name: "Christchurch", lat: -43.6017, lng: 172.7188, arrival: getDate("01-27","07:00"), departure: getDate("01-27","17:00") },
    { name: "Dunedin", lat: -45.8159, lng: 170.6272, arrival: getDate("01-28","07:30"), departure: getDate("01-28","16:00") },
    { name: "Fiordland NP", lat: -44.6414, lng: 167.8974, arrival: getDate("01-29","16:00"), departure: getDate("01-29","19:00") },
    { name: "Hobart", lat: -42.8821, lng: 147.3272, arrival: getDate("02-01","08:00"), departure: getDate("02-02","18:00") },
    { name: "Eden", lat: -37.0617, lng: 149.9048, arrival: getDate("02-04","08:00"), departure: getDate("02-04","15:00") },
    { name: "Sydney", lat: -33.8688, lng: 151.2093, arrival: getDate("02-05","06:30"), departure: null }
];

const suspiciousActivities = [
    { leg: 1, text: "Vessel motion irregular. Boat appears to be swaying." },
    { leg: 2, text: "Passenger behaviour anomaly. Passengers are suspiciously happy." },
    { leg: 3, text: "Crew activity reduced. Crew must be on break." },
    { leg: 4, text: "Delayed morning movement detected. Passengers having a sleep-in today." },
    { leg: 5, text: "Environmental scan alert. High levels of pineapple density detected." },
    { leg: 6, text: "Visual irregularities observed. Passengers seem unusually interested in door decorations." },
    { leg: 7, text: "Repeat corridor traffic detected. Nobody appears to be going anywhere." },
    { leg: 8, text: "Ship stationary. Internal motion continues." },
    { leg: 9, text: "Noise sensors report laughter followed by silence." },
    { leg:10, text: "Multiple Do Not Disturb indicators active simultaneously." },
    { leg:11, text: "Crew avoiding certain corridors." },
    { leg:12, text: "Docked longer than expected. Engines idle. Ship still rocking." },
    { leg:13, text: "Passenger return rate unusually delayed." },
    { leg:14, text: "Automated systems recommend minding own business." }
];

function initMap() {
    map = new google.maps.Map(document.getElementById("map"), {
        zoom: 5,
        center: { lat: -40, lng: 165 }
    });

    shipMarker = new google.maps.Marker({
        map: map,
        icon: {
            url: "icon.png",
            scaledSize: new google.maps.Size(120,120),
            anchor: new google.maps.Point(60,60)
        }
    });

    setInterval(updateShipStatus, 1000);
    updateShipStatus();
}

function updateShipStatus() {
    const now = Date.now();
    const start = schedule[0].departure;

    let pos = schedule[0];
    let status = "Awaiting Departure";
    let next = schedule[1].name;
    let day = 0;

    if (now > start) {
        day = Math.ceil((now - start) / (1000*60*60*24));
        for (let i=0;i<schedule.length-1;i++) {
            if (now > schedule[i].departure && now < schedule[i+1].arrival) {
                pos = {
                    lat: schedule[i].lat + (schedule[i+1].lat - schedule[i].lat) * 0.5,
                    lng: schedule[i].lng + (schedule[i+1].lng - schedule[i].lng) * 0.5
                };
                status = "At Sea üåä";
                next = schedule[i+1].name;
                break;
            }
        }
    }

    shipMarker.setPosition(pos);
    map.panTo(pos);

    document.getElementById("status-text").innerText = status;
    document.getElementById("trip-day").innerText = day ? `Day ${day}` : "--";
    document.getElementById("next-stop").innerText = next;
    document.getElementById("bruce-counter").innerText = String(day*150).padStart(4,"0");

    const alert = suspiciousActivities.find(a => a.leg === day);
    const box = document.getElementById("suspicious-box");

    document.getElementById("suspicious-text").innerText =
        alert
        ? alert.text
        : "Cargo inspection underway. Crates being loaded appear to contain tropical fruit.";

    box.style.display = "block";
}
</script>

</body>
</html>
